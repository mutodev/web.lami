<!-- ITEMS LIST-->
<div [formGroup]="formGroup">
    <div class="grid grid-row-3">

         <!-- ADD ITEM BUTTON -->
         <div class="grid grid-cols-12 gap-x-4 text-lg font-medium mb-5">
            <button (click)="addItemRowBtn()" class="col-span-2" mat-stroked-button [color]="'primary'">
                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                <span class="ml-2 mr-1">Agregar artículo</span>
            </button>
        </div>


        <!-- HEADER ITEMS-->
        <div class="grid p-3 grid-cols-12 items-center gap-x-4 text-white  bg-zinc-500">
            <div class="col-span-3 font-medium text-md">Descripción</div>
            <div class="col-span-1 font-medium text-md text-center">Desc %</div>
            <div class="col-span-1 font-medium text-md text-center">Cant.</div>
            <div class="col-span-1 font-medium text-md text-center">Proyecto</div>
            <div class="col-span-1 font-medium text-md text-center">Imp.</div>
            <!-- <div class="col-span-1 font-medium text-md text-left">Cantidad</div> -->
            <div class="col-span-2 font-medium text-md text-right">Precio</div>
            <div class="col-span-2 font-medium text-md text-right">Total</div>
            <div class="col-span-1 font-medium text-md text-left"></div>
        </div>
        <!-- Body ITEMS-->
        <div class="grid mt-1 p-3  grid-cols-12  gap-x-4 items-center" formArrayName="items">
           
            <!-- Items Array -->
            <ng-container *ngFor="let item of items.controls; let i=index">
                <ng-container [formGroup]="item">
                    <!-- Items -->
                    <div class="col-span-3 text-base font-medium">

                        <div class="font-semibold">{{ item.get('code').value }}</div>
                        <div class="text-secondary" >{{ item.get('name').value }}</div>
                      
                    </div> 
                    
                    <!-- Desc -->
                    <div class="col-span-1 self-center text-left">
                        <mat-form-field floatLabel="never" appearance="legacy" class="w-full fuse-mat-dense">
                            <input type="number" min="0" formControlName="discount" [placeholder]="'Desc%'" matInput>
                        </mat-form-field>
                    </div>

                     <!-- Cantidad -->
                     <div class="col-span-1 self-center text-left">
                        <mat-form-field floatLabel="never" appearance="legacy" class="w-full fuse-mat-dense">
                            <input type="number" min="1" formControlName="quantity" class="text-center" matInput>
                        </mat-form-field>
                    </div>

                  
                    <!-- PROJECT -->
                    <div class="col-span-1 self-center text-left">
                        <mat-form-field floatLabel="never" appearance="legacy" class="w-full fuse-mat-dense">
                            <mat-select formControlName="project" [placeholder]="'Proyecto'">
                                <mat-option *ngFor="let project of projects" [value]="project.code">{{project.name}}</mat-option>
                            </mat-select>

                        </mat-form-field>
                    </div>

                    <!-- iva -->
                    <div class="col-span-1 self-center text-left">
                        <mat-form-field floatLabel="never" appearance="legacy" class="w-full fuse-mat-dense">
                            <mat-select formControlName="tax" [placeholder]="'Impuesto'">
                                <mat-option class="text-sm" *ngFor="let tax of taxes" [value]="tax.code">{{tax.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                      <!-- price -->
                      <div class="col-span-2 self-center text-right border-nonet">
                        <div class="font-semibold text-lg" >{{ item.get('price').value | currency }}</div>
                    </div>

                    <!-- Total -->
                    <div class="col-span-2 self-center text-right">
                        <div class="font-semibold text-lg" >{{ item.get('total').value | currency }}</div>
                    </div>
                    <div class="col-span-1 self-center text-right">
                        <button (click)="removeItemRowBtn(i)" mat-button>
                            <mat-icon class="text-gray-400 icon-size-5" [svgIcon]="'heroicons_solid:x'">
                            </mat-icon>
                        </button>
                    </div>
                </ng-container>
                <!-- Divider -->
                <div class="col-span-12 my-1 border-b"></div>
            </ng-container>

            <div class="col-span-12 text-center text-secondary" *ngIf="items.controls.length == 0">
                No hay artículos agregados a este pedido.
            </div>
            
        </div>
    </div>
</div>

<!-- TOTALES-->
<div class="grid grid-row-1">
    <div class="grid grid-cols-3">
        <!-- COMMENTS -->
        <div class=" font-medium text-md pt-10">
            <mat-form-field appearance="outline" class="w-full fuse-mat-dense">
                <textarea placeholder="Comentarios..." [(ngModel)]="comments" matInput name="comments" id="comments" cols="10" rows="5"></textarea>
            </mat-form-field>
        </div>
        <div class="font-medium text-md">

        </div>
        <div class="font-medium text-md text-left">
            <div class="grid gap-2 grid-cols-2 p-3">

                <div class="self-center font-medium tracking-tight text-secondary text-right">
                    SUBTOTAL
                </div>
                <div class="text-right text-lg">{{subTotal | currency}}</div>

                <ng-container *ngFor="let tax of totalTaxes">
                    <div class="self-center font-medium tracking-tight text-secondary text-right uppercase">
                        {{tax.name}}
                    </div>
                    <div class="text-right text-lg text-right"> {{tax.value | currency}}</div>
                </ng-container>

                <ng-container *ngIf="discount > 0">
                    <div class="self-center font-medium tracking-tight text-secondary text-right ">
                        DESCUENTO</div>
                    <div class="text-right text-lg text-right">- {{discount | currency}}</div>
                </ng-container>
                <!-- Divider -->
                <div class="col-span-2 my-3 border-b"></div>

                <!-- Total -->
                <div class="self-center text-2xl font-medium tracking-tight text-secondary text-righ">
                    TOTAL</div>
                <div class="text-right text-2xl font-medium text-righ">{{total | currency}}</div>
            </div>
        </div>
    </div>

</div>